<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Success Point - View Result</title>
    <link rel="icon" href="/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <style>
        #header {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background-color: #f8f9fa; display: flex; justify-content: space-between;
            align-items: center; padding: 0 20px; border-bottom: 2px solid #dee2e6; z-index: 50;
        }
        #resultContainer {
            margin-top: 80px; display: flex; flex-direction: column; align-items: center;
            padding-bottom: 20px; background-color: #e9ecef; min-height: 100vh;
        }
        canvas, img {
            margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 95%; background-color: white; border: 1px solid #ccc;
        }
    </style>
</head>
<body class="bg-gray-200">

    <div id="header">
        <div class="font-bold text-gray-700 text-lg">Result Portal</div>
        <div class="flex gap-3">
            <button onclick="window.print()" class="bg-blue-600 text-white font-bold py-1.5 px-4 rounded shadow text-sm">üñ®Ô∏è Print</button>
            <button onclick="forceDownload()" class="bg-green-600 text-white font-bold py-1.5 px-4 rounded shadow text-sm">‚¨áÔ∏è Download</button>
        </div>
    </div>

    <div id="resultContainer">
        <p id="loadingMsg" class="text-xl font-bold mt-10 text-gray-700 animate-pulse">Loading Result... ‚è≥</p>
    </div>

    <script>
        const fileUrl = sessionStorage.getItem('pdfLink');
        const container = document.getElementById('resultContainer');
        const loadingMsg = document.getElementById('loadingMsg');
        
        if (!fileUrl) {
            container.innerHTML = "<h2 class='text-red-600 mt-10 text-xl font-bold'>No Result Found!</h2>";
        } else {
            // ‡§ö‡•á‡§ï ‡§ï‡§∞‡•ã ‡§ï‡§ø ‡§´‡§æ‡§á‡§≤ PDF ‡§π‡•à ‡§Ø‡§æ Photo (JPG/PNG)
            const isImage = fileUrl.toLowerCase().match(/\.(jpg|jpeg|png|webp|gif|avif)/i);

            if (isImage) {
                // ‡§Ö‡§ó‡§∞ ‡§´‡•ã‡§ü‡•ã ‡§π‡•à ‡§§‡•ã ‡§∏‡•Ä‡§ß‡§æ <img> ‡§ü‡•à‡§ó ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§ì
                const img = document.createElement('img');
                img.src = fileUrl;
                loadingMsg.style.display = 'none';
                container.appendChild(img);
            } else {
                // ‡§Ö‡§ó‡§∞ PDF ‡§π‡•à ‡§§‡•ã ‡§™‡•Å‡§∞‡§æ‡§®‡§æ PDF.js ‡§µ‡§æ‡§≤‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§ö‡§≤‡§æ‡§ì
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
                pdfjsLib.getDocument(fileUrl).promise.then(function(pdf) {
                    loadingMsg.style.display = 'none'; 
                    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                        pdf.getPage(pageNum).then(function(page) {
                            let scale = window.innerWidth < 600 ? 1.2 : 1.5;
                            const viewport = page.getViewport({ scale: scale });
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            container.appendChild(canvas);
                            page.render({ canvasContext: context, viewport: viewport });
                        });
                    }
                }).catch(err => {
                    loadingMsg.innerText = "Error Loading PDF.";
                });
            }
        }

        function forceDownload() {
            if(fileUrl) {
                const directUrl = fileUrl.replace('/upload/', '/upload/fl_attachment/');
                window.location.href = directUrl;
            }
        }
    </script>
</body>
</html>
