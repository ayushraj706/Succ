<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Upload Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-lg p-8 w-full max-w-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Upload PDF Result</h2>
        
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Student Roll Number</label>
            <input type="text" id="adminRoll" placeholder="e.g. 101" 
                class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-green-500 outline-none">
        </div>

        <button id="upload_widget" 
            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-md shadow transition-colors flex justify-center items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
            Upload PDF to Cloud
        </button>

        <p id="uploadStatus" class="mt-4 text-center font-bold text-green-600 hidden">âœ… Saved Successfully!</p>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCCqWVSgULjZtgfOqVX3CBmOonxkr2UB7g",
            authDomain: "whatsapp-950a8.firebaseapp.com",
            projectId: "whatsapp-950a8",
            storageBucket: "whatsapp-950a8.firebasestorage.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Cloudinary Logic
        const myWidget = cloudinary.createUploadWidget({
            cloudName: 'dprbizfao', 
            uploadPreset: 'w7rfbhdb',
            clientAllowedFormats: ['pdf'],
            multiple: false
        }, (error, result) => { 
            if (!error && result && result.event === "success") { 
                const pdfUrl = result.info.secure_url;
                const roll = document.getElementById('adminRoll').value;
                
                if(!roll) {
                    alert("Roll number khali tha! Data save nahi hua.");
                    return;
                }

                // Save to Firestore
                db.collection("results").doc(roll).set({
                    rollNo: roll,
                    pdfUrl: pdfUrl,
                    timestamp: new Date()
                }).then(() => {
                    const status = document.getElementById('uploadStatus');
                    status.classList.remove('hidden');
                    setTimeout(() => status.classList.add('hidden'), 3000);
                    document.getElementById('adminRoll').value = ''; // Input clear kar do
                });
            }
        });

        document.getElementById("upload_widget").addEventListener("click", function(){
            const roll = document.getElementById('adminRoll').value;
            if(!roll) return alert("Pehle Roll Number daalo!");
            myWidget.open();
        }, false);
    </script>
</body>
</html>
